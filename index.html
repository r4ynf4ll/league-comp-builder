<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>League Comp Builder</title>
  <style>
    body {
      font-family: 'Segoe UI', 'Arial', sans-serif;
      background: none;
      position: relative;
      color: #e4c97b;
      margin: 0;
      min-height: 100vh;
    }
    header {
      background: linear-gradient(90deg, #1b2740 0%, #2e3a5e 100%);
      padding: 1.5rem;
      text-align: center;
      font-size: 2.5rem;
      color: #e4c97b;
      font-family: 'Cinzel', 'Georgia', serif;
      letter-spacing: 2px;
      border-bottom: 3px solid #c89b3c;
      box-shadow: 0 2px 8px #000a;
    }
    main {
      max-width: 950px;
      margin: 2rem auto;
      padding: 2.5rem;
      background: rgba(20, 24, 38, 0.95);
      border-radius: 18px;
      box-shadow: 0 4px 24px #000c;
      border: 2px solid #c89b3c;
    }
    section {
      margin-bottom: 2.5rem;
    }
    label {
      display: block;
      margin-bottom: 0.5rem;
      color: #c89b3c;
      font-weight: bold;
      font-family: 'Cinzel', 'Georgia', serif;
    }
    input, select, button, textarea {
      margin-bottom: 1rem;
      padding: 0.5rem;
      border-radius: 8px;
      border: 1px solid #c89b3c;
      background: #181a20;
      color: #e4c97b;
      font-size: 1rem;
      font-family: 'Segoe UI', 'Arial', sans-serif;
    }
    input, select, textarea {
      width: 100%;
      max-width: 180px;
      box-sizing: border-box;
    }
    button {
      background: linear-gradient(90deg, #c89b3c 0%, #e4c97b 100%);
      color: #181a20;
      cursor: pointer;
      font-weight: bold;
      border: 2px solid #c89b3c;
      box-shadow: 0 2px 8px #000a;
      transition: background 0.2s, color 0.2s;
    }
    button:hover {
      background: linear-gradient(90deg, #e4c97b 0%, #c89b3c 100%);
      color: #1b2740;
    }
    .comp-list {
      display: flex;
      gap: 1.5rem;
      flex-wrap: wrap;
      justify-content: center;
    }
    .comp-card {
      background: linear-gradient(135deg, #23272f 60%, #1b2740 100%);
      padding: 1.2rem;
      border-radius: 12px;
      min-width: 220px;
      border: 2px solid #c89b3c;
      box-shadow: 0 2px 12px #000a;
      color: #e4c97b;
      font-family: 'Segoe UI', 'Arial', sans-serif;
    }
    .champion {
      font-weight: bold;
      color: #c89b3c;
      font-family: 'Cinzel', 'Georgia', serif;
      font-size: 1.1em;
    }
    .synergy {
      color: #43b581;
      font-weight: bold;
    }
    .warning {
      color: #faa61a;
      font-weight: bold;
    }
    h2, h3 {
      font-family: 'Cinzel', 'Georgia', serif;
      color: #e4c97b;
      text-shadow: 0 2px 8px #000a;
    }
    hr {
      border: none;
      border-top: 2px solid #c89b3c;
      margin: 0.7em 0;
    }
    #bg-stack {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      overflow: hidden;
      z-index: 0;
    }
    .bg-splash {
      position: absolute;
      left: 0;
      width: 100vw;
      height: 20vh;
      background-size: cover;
      background-position: center top;
      background-repeat: no-repeat;
      z-index: 0;
      opacity: 1;
    }
    main, header, section, .comp-card, .comp-list {
      position: relative;
      z-index: 1;
    }
  </style>
</head>
<body>
  <div id="bg-stack">
    <div class="bg-splash" style="background-image:url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Ahri_0.jpg'); top:0vh; background-position:center 20%;"></div>
    <div class="bg-splash" style="background-image:url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Viego_0.jpg'); top:20vh; background-position:center 10%;"></div>
    <div class="bg-splash" style="background-image:url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Fiora_0.jpg'); top:40vh; background-position:center 5%;"></div>
    <div class="bg-splash" style="background-image:url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Thresh_0.jpg'); top:60vh; background-position:center 0%;"></div>
    <div class="bg-splash" style="background-image:url('https://ddragon.leagueoflegends.com/cdn/img/champion/splash/Jinx_0.jpg'); top:80vh; background-position:center 20%;"></div>
  </div>
  <header>League Comp Builder</header>
  <div style="text-align:center; margin-top:1rem; margin-bottom:2rem; font-size:1.2rem; color:#f7b731;">
    <div style="display:inline-block; background:rgba(20,24,38,0.95); border-radius:10px; padding:1rem 2rem; border:2px solid #c89b3c; color:#f7b731; font-size:1.2rem;">
      <b>Team Playstyle Advice:</b><br>
      Play through your strong solo lanes by enabling them to win 1v1s and pressure the map. Let your low-resource jungler focus on efficient farming and supporting lanes when needed. Use your roaming support to create vision and help set up plays across the map. Allow your ADC to farm safely and scale for late-game teamfights. Prioritize lane pressure, map control, and coordinated roams to maximize your strengths.
    </div>
  </div>
  <main>
    <section id="ban-section">
      <h2>Opponent Bans</h2>
      <form id="ban-form" style="display:flex; gap:1rem; flex-wrap:wrap; align-items:center;">
        <div style="display:flex; gap:1rem; flex-wrap:wrap;">
          <input type="text" id="ban1" placeholder="Ban 1" maxlength="20" />
          <input type="text" id="ban2" placeholder="Ban 2" maxlength="20" />
          <input type="text" id="ban3" placeholder="Ban 3" maxlength="20" />
          <input type="text" id="ban4" placeholder="Ban 4" maxlength="20" />
          <input type="text" id="ban5" placeholder="Ban 5" maxlength="20" />
        </div>
        <button type="submit" id="submit-bans" style="margin-left:1rem;">Apply Bans</button>
        <button type="button" id="refresh-bans" style="margin-left:1rem;">Refresh Bans</button>
      </form>
      <div id="ban-list" style="margin-top:0.5rem;"></div>
    </section>
    <section id="opponent-section">
      <h2>Opponent Champion Picks</h2>
      <form id="opponent-form" style="display:flex; gap:1rem; flex-wrap:wrap;">
        <div style="display:flex; flex-wrap:wrap; gap:1rem; width:100%;">
          <div style="flex:1; min-width:150px; max-width:180px;">
            <label>Top Opponent</label>
            <input type="text" id="opp-top" placeholder="e.g. Renekton" />
          </div>
          <div style="flex:1; min-width:150px; max-width:180px;">
            <label>Jungle Opponent</label>
            <input type="text" id="opp-jungle" placeholder="e.g. Lee Sin" />
          </div>
          <div style="flex:1; min-width:150px; max-width:180px;">
            <label>Mid Opponent</label>
            <input type="text" id="opp-mid" placeholder="e.g. Ekko" />
          </div>
          <div style="flex:1; min-width:150px; max-width:180px;">
            <label>ADC Opponent</label>
            <input type="text" id="opp-adc" placeholder="e.g. Ezreal" />
          </div>
          <div style="flex:1; min-width:150px; max-width:180px;">
            <label>Support Opponent</label>
            <input type="text" id="opp-support" placeholder="e.g. Blitzcrank" />
          </div>
        </div>
        <button type="submit">Suggest Counter Comp</button>
      </form>
      <div id="counter-comp-result"></div>
    </section>
    <section id="recommend-section">
      <h2>Recommended Team Comps</h2>
      <div style="display:flex; gap:2rem; justify-content:center;">
        <div style="flex:1; min-width:220px;">
          <h3 style="text-align:center; color:#43b581;">Dive Comp</h3>
          <div class="comp-list" id="dive-list"></div>
        </div>
        <div style="flex:1; min-width:220px;">
          <h3 style="text-align:center; color:#faa61a;">Poke Comp</h3>
          <div class="comp-list" id="poke-list"></div>
        </div>
      </div>
    </section>
    <section id="manual-section">
      <h2>Manual Comp Builder</h2>
      <form id="manual-form">
        <label>Top Champion</label>
        <input type="text" id="manual-top" />
        <label>Jungle Champion</label>
        <input type="text" id="manual-jungle" />
        <label>Mid Champion</label>
        <input type="text" id="manual-mid" />
        <label>ADC Champion</label>
        <input type="text" id="manual-adc" />
        <label>Support Champion</label>
        <input type="text" id="manual-support" />
        <button type="submit">Analyze Comp</button>
      </form>
      <div id="manual-result"></div>
    </section>
  </main>
  <script>
    // Champion data will be loaded from Data Dragon
    // Custom synergy scores and lane info
    const customChampionData = {
      Aatrox: { scores: { engage: 2, poke: 1, cc: 1, teamfight: 1 }, lanes: ["top"] },
      Ahri: { scores: { engage: 3, poke: 2, cc: 1, teamfight: 1 }, lanes: ["mid"] },
      Akali: { scores: { engage: 2, poke: 1, cc: 1, teamfight: 1 }, lanes: ["mid", "top"] },
      Camille: { scores: { engage: 3, poke: 1, cc: 1, teamfight: 1 }, lanes: ["top"] },
      Fiora: { scores: { engage: 3, poke: 1, cc: 2, teamfight: 1 }, lanes: ["top"] },
      Jinx: { scores: { engage: 1, poke: 2, cc: 1, teamfight: 1 }, lanes: ["adc"] },
      Thresh: { scores: { engage: 2, poke: 1, cc: 3, teamfight: 1 }, lanes: ["support"] },
      LeeSin: { scores: { engage: 3, poke: 1, cc: 2, teamfight: 1 }, lanes: ["jungle"] },
      Ornn: { scores: { engage: 2, poke: 1, cc: 2, teamfight: 2 }, lanes: ["top"] },
      Gwen: { scores: { engage: 2, poke: 1, cc: 1, teamfight: 1 }, lanes: ["top"] },
      Jax: { scores: { engage: 2, poke: 1, cc: 1, teamfight: 1 }, lanes: ["top"] },
      Viego: { scores: { engage: 3, poke: 1, cc: 1, teamfight: 1 }, lanes: ["jungle"] },
      Lillia: { scores: { engage: 2, poke: 2, cc: 1, teamfight: 1 }, lanes: ["jungle"] },
      Syndra: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["mid"] },
      Lucian: { scores: { engage: 2, poke: 2, cc: 1, teamfight: 1 }, lanes: ["adc", "mid"] },
      Seraphine: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["support", "mid"] },
      Cassiopeia: { scores: { engage: 1, poke: 2, cc: 1, teamfight: 1 }, lanes: ["mid"] },
      Zed: { scores: { engage: 2, poke: 1, cc: 1, teamfight: 1 }, lanes: ["mid"] },
      Leblanc: { scores: { engage: 2, poke: 2, cc: 1, teamfight: 1 }, lanes: ["mid"] },
      Kaisa: { scores: { engage: 1, poke: 3, cc: 1, teamfight: 1 }, lanes: ["adc"] },
      MissFortune: { scores: { engage: 1, poke: 3, cc: 2, teamfight: 1 }, lanes: ["adc"] },
      Braum: { scores: { engage: 2, poke: 1, cc: 3, teamfight: 2 }, lanes: ["support"] },
      Hwei: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["support", "mid"] },
      Velkoz: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["support", "mid"] },
      Milio: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["support"] },
      Renata: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["support"] },
      Gragas: { scores: { engage: 2, poke: 2, cc: 1, teamfight: 2 }, lanes: ["top", "jungle"] },
      Rell: { scores: { engage: 2, poke: 1, cc: 3, teamfight: 1 }, lanes: ["support"] },
      TahmKench: { scores: { engage: 2, poke: 1, cc: 3, teamfight: 1 }, lanes: ["support", "top"] },
      Nautilus: { scores: { engage: 2, poke: 1, cc: 3, teamfight: 1 }, lanes: ["support"] },
      Leona: { scores: { engage: 2, poke: 1, cc: 3, teamfight: 1 }, lanes: ["support"] },
      Lulu: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["support"] },
      Soraka: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["support"] },
      Janna: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["support"] },
      Karma: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["support", "mid"] },
      Pyke: { scores: { engage: 2, poke: 1, cc: 2, teamfight: 1 }, lanes: ["support"] },
      Pantheon: { scores: { engage: 3, poke: 2, cc: 1, teamfight: 1 }, lanes: ["top", "support"] },
      Xerath: { scores: { engage: 1, poke: 2, cc: 2, teamfight: 1 }, lanes: ["mid", "support"] },
      Blitzcrank: { scores: { engage: 2, poke: 1, cc: 3, teamfight: 2 }, lanes: ["support"] }
    };
    let championTags = {};
    async function fetchChampionData() {
      // Get latest version
      const versionResp = await fetch('https://ddragon.leagueoflegends.com/api/versions.json');
      const versions = await versionResp.json();
      const latestVersion = versions[0];
      // Get champion data
      const champResp = await fetch(`https://ddragon.leagueoflegends.com/cdn/${latestVersion}/data/en_US/champion.json`);
      const champData = await champResp.json();
      // Convert Data Dragon format to championTags format
      Object.entries(champData.data).forEach(([key, champ]) => {
        championTags[key] = {
          name: champ.name,
          title: champ.title,
          tags: champ.tags,
          // Data Dragon does not provide scores/lanes, so fallback to empty/defaults
          scores: { engage: 1, poke: 1, cc: 1, teamfight: 1 },
          lanes: []
        };
      });
      // After loading Data Dragon, merge custom scores/lanes
      Object.entries(customChampionData).forEach(([key, custom]) => {
        if (championTags[key]) {
          championTags[key].scores = custom.scores;
          championTags[key].lanes = custom.lanes;
        }
      });
      // Debug: log all loaded champion keys
      setTimeout(() => {
        console.log('Loaded champion keys from Data Dragon:', Object.keys(championTags));
        document.dispatchEvent(new Event('championDataLoaded'));
      }, 2000);
    }
    // Fetch champion data on page load
    document.addEventListener('DOMContentLoaded', () => {
      fetchChampionData();
      document.addEventListener('championDataLoaded', () => {
        showRecommendedComps();
        renderCounterComp();
      });
    });

    // --- Champion pools ---
    const championPools = {
      top: {
        S: ['Fiora'],
        A: ['Gwen', 'Ornn', 'Camille', 'Jax'],
        Counters: ["Poppy", "Cho'Gath", "Renekton", "Jayce", "Pantheon"]
      },
      jungle: {
        S: ['Viego', 'Jarvan IV', 'Lillia', 'Maokai'],
        A: ['Karthus', 'Zyra', 'Sejuani', 'Dr. Mundo', 'Elise', 'Kha Zix', 'Diana', 'Trundle'],
        Counters: ['Ivern', 'Jax', 'Rammus', 'Morgana', 'Taliyah', 'Zac', 'Kayn']
      },
      mid: {
        S: ['Ahri', 'Akali', 'Syndra', 'Lucian'],
        A: ['Seraphine', 'Cassiopeia', 'Zed', 'LeBlanc'],
        Counters: ['Katarina', 'Ekko', 'Qiyana']
      },
      adc: {
        S: ['Jinx', 'Ashe'],
        A: ['Kai\'Sa', 'Miss Fortune'],
        Counters: ['Tristana', 'Ezreal', 'Sivir', 'Samira']
      },
      support: {
        S: ['Thresh', 'Braum', 'Hwei', 'Velkoz', 'Milio', 'Renata', 'Gragas', 'Rell', 'Tahm Kench'],
        A: ['Nautilus', 'Leona', 'Lulu', 'Soraka', 'Janna', 'Karma', 'Most other supports'],
        Counters: ['Pyke', 'Pantheon', 'Xerath', 'Blitzcrank']
      }
    };

    // --- Ban Logic ---
    let bannedChamps = [];
    function getBansFromInputs() {
      return [
        document.getElementById('ban1').value.trim(),
        document.getElementById('ban2').value.trim(),
        document.getElementById('ban3').value.trim(),
        document.getElementById('ban4').value.trim(),
        document.getElementById('ban5').value.trim()
      ].filter(b => b);
    }
    function updateBanList() {
      bannedChamps = getBansFromInputs().map(b => b.toLowerCase());
      document.getElementById('ban-list').innerHTML = bannedChamps.length ? `<b>Banned Champions:</b> ${bannedChamps.join(', ')}` : '';
    }

    // --- Synergy scoring ---
    function getSynergyScores(champName) {
  // Debug: log normalized lookup key
      function normalizeName(name) {
        // Remove non-alphanumerics, then camel case
        return name
          .toLowerCase()
          .replace(/[^a-z0-9 ]/g, ' ') // replace non-alphanumerics with space
          .split(' ')
          .filter(Boolean)
          .map(w => w.charAt(0).toUpperCase() + w.slice(1))
          .join('');
      }
      const lookupKey = normalizeName(champName);
      console.log(`Looking up champion: '${champName}' as key: '${lookupKey}'`);
      let champ = championTags[lookupKey];
      if (!champ) {
        // Try case-insensitive match against all keys
        const foundKey = Object.keys(championTags).find(k => k.toLowerCase() === lookupKey.toLowerCase());
        console.log(`Case-insensitive search for '${lookupKey}' found:`, foundKey);
        if (foundKey) champ = championTags[foundKey];
      }
      if (!champ) {
        console.log(`Champion '${champName}' not found. Lookup key: '${lookupKey}'. All keys:`, Object.keys(championTags));
        return { engage: 1, poke: 1, cc: 1, teamfight: 1, breakdown: `<div class='warning'>${champName}: Not found in Data Dragon</div>` };
      }
      // Use scores if present, else default
      let engage = champ.scores?.engage ?? 1;
      let poke = champ.scores?.poke ?? 1;
      let cc = champ.scores?.cc ?? 1;
      let teamfight = champ.scores?.teamfight ?? 1;
      const tags = champ.tags || [];
      // Lane bonus/penalty
      let laneBonus = 0;
      if (typeof arguments[1] === 'string') {
        const lane = arguments[1];
        if (champ.lanes && champ.lanes.includes(lane)) {
          laneBonus = 1; // Bonus for primary lane
        } else if (champ.lanes && champ.lanes.length > 0) {
          laneBonus = -3; // Strong penalty for off-role
        }
      }
      if (tags.length > 1) {
        engage += 1;
        poke += 1;
        cc += 1;
        teamfight += 1;
      }
      engage = Math.min(engage + laneBonus, 5);
      poke = Math.min(poke + laneBonus, 5);
      cc = Math.min(cc + laneBonus, 5);
      teamfight = Math.min(teamfight + laneBonus, 5);
  const breakdown = `<div><b>${champName}</b>: Engage ${engage}, Poke ${poke}, CC ${cc}, Teamfight ${teamfight}${laneBonus === 1 ? " <span style='color:#43b581'>(Primary Lane)</span>" : laneBonus === -1 ? " <span style='color:#faa61a'>(Off-role)</span>" : ''}</div>`;
      return { engage, poke, cc, teamfight, breakdown };
    }

    // --- Recommended Comps ---
    function showRecommendedComps() {
      const diveList = document.getElementById('dive-list');
      const pokeList = document.getElementById('poke-list');
      diveList.innerHTML = '';
      pokeList.innerHTML = '';
      const lanes = ['Top','Jungle','Mid','ADC','Support'];
      // 5 recommended comps for each type
      const diveComps = [
        ['Camille','Viego','Akali','Jinx','Thresh'],
        ['Fiora','Lee Sin','Syndra','Jinx','Leona'],
        ['Ornn','Viego','Lucian','Jinx','Thresh'],
        ['Gwen','Viego','Akali','Jinx','Braum'],
        ['Jax','Lee Sin','Syndra','Jinx','Thresh']
      ];
      const pokeComps = [
        ['Gwen','Lillia','Seraphine','Kai\'Sa','Lulu'],
        ['Jax','Viego','Cassiopeia','Miss Fortune','Soraka'],
        ['Camille','Lillia','LeBlanc','Jinx','Janna'],
        ['Ornn','Lillia','Syndra','Kai\'Sa','Lulu'],
        ['Fiora','Viego','Seraphine','Miss Fortune','Soraka']
      ];
      const maxScore = { engage: 20, poke: 20, cc: 20, teamfight: 20, overall: 80 };
      function getValidComp(comp) {
        // Replace banned champs with next best available from pools
        const lanes = ['top','jungle','mid','adc','support'];
        return comp.map((champ, i) => {
          if (!bannedChamps.includes(champ.toLowerCase())) return champ;
          // Find replacement from pool
          const pool = championPools[lanes[i]];
          const allChoices = [...pool.S, ...pool.A, ...(pool.Counters||[])].filter(c => !bannedChamps.includes(c.toLowerCase()) && !comp.includes(c));
          return allChoices[0] || 'Any';
        });
      }

      function getCompSummary(scores, comp, lanes) {
        let summary = '';
        const { engage, poke, cc, teamfight } = scores;
        let strengths = [], weaknesses = [], details = [];
        // Analyze champion synergy and lane fit
        console.log('getCompSummary called with:', {scores, comp, lanes});
        comp.forEach((champ, i) => {
          console.log('Looking up champion for comp:', champ);
          // Normalize champion name for lookup
          function normalizeName(name) {
            return name.replace(/[^aA-zZ0-9]/g, '').toLowerCase();
          }
          let champObj = championTags[champ] || Object.values(championTags).find(c => normalizeName(c.name) === normalizeName(champ));
          if (!champObj) console.warn('Champion not found in championTags:', champ);
          if (!champObj) return;
          let lane = lanes[i];
          let tags = champObj.tags || [];
          let laneFit = champObj.lanes && champObj.lanes.includes(lane) ? 'primary' : (champObj.lanes && champObj.lanes.length > 0 ? 'off-role' : 'unknown');
          details.push(`${champ} (${lane}): ${tags.join(', ')}${laneFit === 'primary' ? ' [main role]' : laneFit === 'off-role' ? ' [off-role]' : ''}`);
        });
        // Synergy highlights
        if (engage >= 15) strengths.push('strong engage potential, especially from ' + comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          return champObj && champObj.scores && champObj.scores.engage >= 3;
        }).join(', '));
        if (poke >= 15) strengths.push('excellent poke from ' + comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          return champObj && champObj.scores && champObj.scores.poke >= 3;
        }).join(', '));
        if (cc >= 15) strengths.push('high crowd control from ' + comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          return champObj && champObj.scores && champObj.scores.cc >= 3;
        }).join(', '));
        if (teamfight >= 15) strengths.push('great teamfighting, especially with ' + comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          return champObj && champObj.scores && champObj.scores.teamfight >= 2;
        }).join(', '));
        // Weaknesses
        if (engage <= 7) weaknesses.push('weak engage overall');
        if (poke <= 7) weaknesses.push('low poke');
        if (cc <= 7) weaknesses.push('limited crowd control');
        if (teamfight <= 7) weaknesses.push('poor teamfighting');
        // Off-role warning
        let offRoles = comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          let lane = lanes[i];
          return champObj && champObj.lanes && champObj.lanes.length > 0 && !champObj.lanes.includes(lane);
        });
        if (offRoles.length) weaknesses.push('off-role picks: ' + offRoles.join(', '));
        summary += strengths.length ? `<b>Strengths:</b> ${strengths.join('; ')}.<br>` : '';
        summary += weaknesses.length ? `<b>Weaknesses:</b> ${weaknesses.join('; ')}.` : '';
        summary += `<br><b>Champion Details:</b> ${details.join(' | ')}`;
        if (!summary) summary = 'Balanced comp with no major strengths or weaknesses.';
        return `<div style='margin-top:0.7em; font-size:1em; color:#e4c97b; background:rgba(20,24,38,0.7); border-radius:8px; padding:0.7em;'>${summary}</div>`;
      }
      diveComps.forEach((comp, idx) => {
        const validComp = getValidComp(comp);
        let scores = { engage: 0, poke: 0, cc: 0, teamfight: 0 };
        let breakdown = '';
        validComp.forEach((champ, i) => {
          if (bannedChamps.includes(champ.toLowerCase())) {
            breakdown += `<div class='warning'>${champ} is banned!</div>`;
            return;
          }
          // Pass lane info to scoring
          const lane = ['top','jungle','mid','adc','support'][i];
          const s = getSynergyScores(champ, lane);
          scores.engage += s.engage;
          scores.poke += s.poke;
          scores.cc += s.cc;
          scores.teamfight += s.teamfight;
          breakdown += s.breakdown;
        });
  // Clamp scores to maxScore
  scores.engage = Math.min(scores.engage, maxScore.engage);
  scores.poke = Math.min(scores.poke, maxScore.poke);
  scores.cc = Math.min(scores.cc, maxScore.cc);
  scores.teamfight = Math.min(scores.teamfight, maxScore.teamfight);
  let total = scores.engage + scores.poke + scores.cc + scores.teamfight;
        const card = document.createElement('div');
        card.className = 'comp-card';
  card.innerHTML = `<b>Comp ${idx+1}</b><br>` + validComp.map((champ, i) => `<span class='champion'>${champ}</span> <span style='color:#43b581;'>(${lanes[i]})</span>`).join('<br>') + `<hr><b>Synergy Scores:</b><br>Engage: ${scores.engage}/${maxScore.engage}, Poke: ${scores.poke}/${maxScore.poke}, CC: ${scores.cc}/${maxScore.cc}, Teamfight: ${scores.teamfight}/${maxScore.teamfight}<br><span style='font-size:1.5em; color:#f7b731; font-weight:bold; display:block; margin:0.5em 0;'>Overall Score: ${total}/${maxScore.overall}</span>${getCompSummary(scores, validComp, ['top','jungle','mid','adc','support'])}${breakdown}`;
  card.innerHTML = `<b>Comp ${idx+1}</b><br>` + validComp.map((champ, i) => `<span class='champion'>${champ}</span> <span style='color:#43b581;'>(${lanes[i]})</span>`).join('<br>') + `<hr><b>Synergy Scores:</b><br>Engage: ${scores.engage}/${maxScore.engage}, Poke: ${scores.poke}/${maxScore.poke}, CC: ${scores.cc}/${maxScore.cc}, Teamfight: ${scores.teamfight}/${maxScore.teamfight}<br><span style='font-size:1.5em; color:#f7b731; font-weight:bold; display:block; margin:0.5em 0;'>Overall Score: ${total}/${maxScore.overall}</span>${getCompSummary(scores, validComp, ['top','jungle','mid','adc','support'])}${breakdown}`;
        diveList.appendChild(card);
      });
      pokeComps.forEach((comp, idx) => {
        const validComp = getValidComp(comp);
        let scores = { engage: 0, poke: 0, cc: 0, teamfight: 0 };
        let breakdown = '';
        validComp.forEach((champ, i) => {
          if (bannedChamps.includes(champ.toLowerCase())) {
            breakdown += `<div class='warning'>${champ} is banned!</div>`;
            return;
          }
          const lane = ['top','jungle','mid','adc','support'][i];
          const s = getSynergyScores(champ, lane);
          scores.engage += s.engage;
          scores.poke += s.poke;
          scores.cc += s.cc;
          scores.teamfight += s.teamfight;
          breakdown += s.breakdown;
        });
  // Clamp scores to maxScore
  scores.engage = Math.min(scores.engage, maxScore.engage);
  scores.poke = Math.min(scores.poke, maxScore.poke);
  scores.cc = Math.min(scores.cc, maxScore.cc);
  scores.teamfight = Math.min(scores.teamfight, maxScore.teamfight);
  let total = scores.engage + scores.poke + scores.cc + scores.teamfight;
        const card = document.createElement('div');
        card.className = 'comp-card';
  card.innerHTML = `<b>Comp ${idx+1}</b><br>` + validComp.map((champ, i) => `<span class='champion'>${champ}</span> <span style='color:#faa61a;'>(${lanes[i]})</span>`).join('<br>') + `<hr><b>Synergy Scores:</b><br>Engage: ${scores.engage}/${maxScore.engage}, Poke: ${scores.poke}/${maxScore.poke}, CC: ${scores.cc}/${maxScore.cc}, Teamfight: ${scores.teamfight}/${maxScore.teamfight}<br><span style='font-size:1.5em; color:#f7b731; font-weight:bold; display:block; margin:0.5em 0;'>Overall Score: ${total}/${maxScore.overall}</span>${getCompSummary(scores, validComp, ['top','jungle','mid','adc','support'])}${breakdown}`;
  card.innerHTML = `<b>Comp ${idx+1}</b><br>` + validComp.map((champ, i) => `<span class='champion'>${champ}</span> <span style='color:#faa61a;'>(${lanes[i]})</span>`).join('<br>') + `<hr><b>Synergy Scores:</b><br>Engage: ${scores.engage}/${maxScore.engage}, Poke: ${scores.poke}/${maxScore.poke}, CC: ${scores.cc}/${maxScore.cc}, Teamfight: ${scores.teamfight}/${maxScore.teamfight}<br><span style='font-size:1.5em; color:#f7b731; font-weight:bold; display:block; margin:0.5em 0;'>Overall Score: ${total}/${maxScore.overall}</span>${getCompSummary(scores, validComp, ['top','jungle','mid','adc','support'])}${breakdown}`;
        pokeList.appendChild(card);
      });
    }

    // --- Counter Comp Builder ---
    function renderCounterComp() {
      function getCompSummary(scores, comp, lanes) {
        let summary = '';
        const { engage, poke, cc, teamfight } = scores;
        let strengths = [], weaknesses = [], details = [];
        // Analyze champion synergy and lane fit
        comp.forEach((champ, i) => {
          let champObj = championTags[champ] || Object.values(championTags).find(c => c.name === champ);
          if (!champObj) return;
          let lane = lanes[i];
          let tags = champObj.tags || [];
          let laneFit = champObj.lanes && champObj.lanes.includes(lane) ? 'primary' : (champObj.lanes && champObj.lanes.length > 0 ? 'off-role' : 'unknown');
          details.push(`${champ} (${lane}): ${tags.join(', ')}${laneFit === 'primary' ? ' [main role]' : laneFit === 'off-role' ? ' [off-role]' : ''}`);
        });
        // Synergy highlights
        if (engage >= 15) strengths.push('strong engage potential, especially from ' + comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          return champObj && champObj.scores && champObj.scores.engage >= 3;
        }).join(', '));
        if (poke >= 15) strengths.push('excellent poke from ' + comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          return champObj && champObj.scores && champObj.scores.poke >= 3;
        }).join(', '));
        if (cc >= 15) strengths.push('high crowd control from ' + comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          return champObj && champObj.scores && champObj.scores.cc >= 3;
        }).join(', '));
        if (teamfight >= 15) strengths.push('great teamfighting, especially with ' + comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          return champObj && champObj.scores && champObj.scores.teamfight >= 2;
        }).join(', '));
        // Weaknesses
        if (engage <= 7) weaknesses.push('weak engage overall');
        if (poke <= 7) weaknesses.push('low poke');
        if (cc <= 7) weaknesses.push('limited crowd control');
        if (teamfight <= 7) weaknesses.push('poor teamfighting');
        // Off-role warning
        let offRoles = comp.filter((c, i) => {
          let champObj = championTags[c] || Object.values(championTags).find(ch => ch.name === c);
          let lane = lanes[i];
          return champObj && champObj.lanes && champObj.lanes.length > 0 && !champObj.lanes.includes(lane);
        });
        if (offRoles.length) weaknesses.push('off-role picks: ' + offRoles.join(', '));
        summary += strengths.length ? `<b>Strengths:</b> ${strengths.join('; ')}.<br>` : '';
        summary += weaknesses.length ? `<b>Weaknesses:</b> ${weaknesses.join('; ')}.` : '';
        summary += `<br><b>Champion Details:</b> ${details.join(' | ')}`;
        if (!summary) summary = 'Balanced comp with no major strengths or weaknesses.';
        return `<div style='margin-top:0.7em; font-size:1em; color:#e4c97b; background:rgba(20,24,38,0.7); border-radius:8px; padding:0.7em;'>${summary}</div>`;
      }
      const oppTop = document.getElementById('opp-top').value.trim().toLowerCase();
      const oppJungle = document.getElementById('opp-jungle').value.trim().toLowerCase();
      const oppMid = document.getElementById('opp-mid').value.trim().toLowerCase();
      const oppADC = document.getElementById('opp-adc').value.trim().toLowerCase();
      const oppSupport = document.getElementById('opp-support').value.trim().toLowerCase();
      function getFilteredPool(pool) {
        return {
          S: pool.S.filter(c => !bannedChamps.includes(c.toLowerCase())),
          A: pool.A.filter(c => !bannedChamps.includes(c.toLowerCase())),
          Counters: pool.Counters ? pool.Counters.filter(c => !bannedChamps.includes(c.toLowerCase())) : []
        };
      }
      const filteredPools = {
        top: getFilteredPool(championPools.top),
        jungle: getFilteredPool(championPools.jungle),
        mid: getFilteredPool(championPools.mid),
        adc: getFilteredPool(championPools.adc),
        support: getFilteredPool(championPools.support)
      };
      function pickCounter(pool, opp) {
        // Only pick counters that are in S/A pool
        if (!opp) {
          let sChoices = pool.S;
          let aChoices = pool.A;
          return sChoices[0] || aChoices[0] || 'Any';
        }
        // Find counters that are also in S/A pool
        let saPool = [...pool.S, ...pool.A];
        let countersInPool = pool.Counters.filter(c => saPool.map(x => x.toLowerCase()).includes(c.toLowerCase()) && c.toLowerCase() !== opp);
        if (countersInPool.length > 0) return countersInPool[0];
        // Otherwise, pick from S/A pool (excluding opponent)
        let sChoices = pool.S.filter(c => c.toLowerCase() !== opp);
        if (sChoices.length > 0) return sChoices[0];
        let aChoices = pool.A.filter(c => c.toLowerCase() !== opp);
        if (aChoices.length > 0) return aChoices[0];
        // If nothing left, fallback to any S/A pool champion
        return pool.S[0] || pool.A[0] || 'Any';
      }
      const counterComp = [
        pickCounter(filteredPools.top, oppTop),
        pickCounter(filteredPools.jungle, oppJungle),
        pickCounter(filteredPools.mid, oppMid),
        pickCounter(filteredPools.adc, oppADC),
        pickCounter(filteredPools.support, oppSupport)
      ];
      const lanes = ['Top','Jungle','Mid','ADC','Support'];
      let scores = { engage: 0, poke: 0, cc: 0, teamfight: 0 };
      let breakdown = '';
      counterComp.forEach((champ, i) => {
    const lane = ['top','jungle','mid','adc','support'][i];
    console.log(`Counter Comp: Looking up champion '${champ}' for lane '${lane}'`);
    const s = getSynergyScores(champ, lane);
        scores.engage += s.engage;
        scores.poke += s.poke;
        scores.cc += s.cc;
        scores.teamfight += s.teamfight;
        breakdown += s.breakdown;
      });
      let total = scores.engage + scores.poke + scores.cc + scores.teamfight;
      const maxScore = { engage: 20, poke: 20, cc: 20, teamfight: 20, overall: 80 };
      let html = `<h3>Suggested Counter Comp</h3><div class='comp-list'>`;
      counterComp.forEach((champ, i) => {
        html += `<div class='comp-card'><span class='champion'>${champ}</span> <span style='color:#faa61a;'>(${lanes[i]})</span></div>`;
      });
  html += `</div><hr><b>Synergy Breakdown:</b><br>${breakdown}${getCompSummary(scores, counterComp, ['top','jungle','mid','adc','support'])}<br><b>Total Scores:</b> Engage: ${scores.engage}/${maxScore.engage}, Poke: ${scores.poke}/${maxScore.poke}, CC: ${scores.cc}/${maxScore.cc}, Teamfight: ${scores.teamfight}/${maxScore.teamfight}<br><b>Overall Score:</b> ${total}/${maxScore.overall}`;
      document.getElementById('counter-comp-result').innerHTML = html;
    }

    // --- Manual Comp Builder ---
    document.getElementById('manual-form').onsubmit = function(e) {
      e.preventDefault();
      const champs = [
        document.getElementById('manual-top').value.trim(),
        document.getElementById('manual-jungle').value.trim(),
        document.getElementById('manual-mid').value.trim(),
        document.getElementById('manual-adc').value.trim(),
        document.getElementById('manual-support').value.trim()
      ];
      const lanes = ['Top','Jungle','Mid','ADC','Support'];
      let scores = { engage: 0, poke: 0, cc: 0, teamfight: 0 };
      let breakdown = '';
      champs.forEach((champ, i) => {
        if (!champ) {
          breakdown += `<div class='warning'>No champion entered for ${lanes[i]}</div>`;
          return;
        }
        if (bannedChamps.includes(champ.toLowerCase())) {
          breakdown += `<div class='warning'>${champ} is banned!</div>`;
          return;
        }
        const lane = ['top','jungle','mid','adc','support'][i];
        const s = getSynergyScores(champ, lane);
        scores.engage += s.engage;
        scores.poke += s.poke;
        scores.cc += s.cc;
        scores.teamfight += s.teamfight;
        breakdown += s.breakdown;
      });
      let total = scores.engage + scores.poke + scores.cc + scores.teamfight;
      const maxScore = { engage: 20, poke: 20, cc: 20, teamfight: 20, overall: 80 };
      let html = `<h3>Manual Comp Analysis</h3><div class='comp-list'>`;
      champs.forEach((champ, i) => {
        html += `<div class='comp-card'><span class='champion'>${champ || 'None'}</span> <span style='color:#43b581;'>(${lanes[i]})</span></div>`;
      });
      html += `</div><hr><b>Synergy Breakdown:</b><br>${breakdown}<br><b>Total Scores:</b> Engage: ${scores.engage}/${maxScore.engage}, Poke: ${scores.poke}/${maxScore.poke}, CC: ${scores.cc}/${maxScore.cc}, Teamfight: ${scores.teamfight}/${maxScore.teamfight}<br><b>Overall Score:</b> ${total}/${maxScore.overall}`;
      document.getElementById('manual-result').innerHTML = html;
    };

    // --- Event Listeners ---
    document.getElementById('ban-form').onsubmit = function(e) {
      e.preventDefault();
      updateBanList();
      showRecommendedComps();
      renderCounterComp();
    };
    document.getElementById('refresh-bans').onclick = function() {
      document.getElementById('ban1').value = '';
      document.getElementById('ban2').value = '';
      document.getElementById('ban3').value = '';
      document.getElementById('ban4').value = '';
      document.getElementById('ban5').value = '';
      updateBanList();
      showRecommendedComps();
      renderCounterComp();
    };
    document.getElementById('opponent-form').onsubmit = function(e) {
      e.preventDefault();
      renderCounterComp();
    };

    // --- Initial Render ---
    updateBanList();
    showRecommendedComps();
    renderCounterComp();
  </script>
  <script>
    // Find highest scoring comp from custom data
    function findHighestScoringComp() {
      const lanes = ['top','jungle','mid','adc','support'];
      // Use only champions from your pools for each lane
      const poolNames = lanes.map(lane => {
        const pool = championPools[lane];
        return [...(pool.S || []), ...(pool.A || []), ...(pool.Counters || [])];
      });
      // Get champion objects for each pool
      const candidates = poolNames.map((names, i) => {
        return names
          .map(name => {
            // Normalize name for lookup
            function normalizeName(n) {
              return n.replace(/[^a-zA-Z0-9]/g, '').toLowerCase();
            }
            // Find matching champion in championTags
            return Object.values(championTags).find(champ => normalizeName(champ.name) === normalizeName(name));
          })
          .filter(Boolean);
      });
      // Generate all possible comps
      let allComps = [];
      function getCompScore(comp) {
        let scores = { engage: 0, poke: 0, cc: 0, teamfight: 0 };
        let breakdown = '';
        comp.forEach((champ, i) => {
          const lane = lanes[i];
          const s = getSynergyScores(champ.name, lane);
          scores.engage += s.engage;
          scores.poke += s.poke;
          scores.cc += s.cc;
          scores.teamfight += s.teamfight;
          breakdown += s.breakdown;
        });
        // Clamp scores
        scores.engage = Math.min(scores.engage, 20);
        scores.poke = Math.min(scores.poke, 20);
        scores.cc = Math.min(scores.cc, 20);
        scores.teamfight = Math.min(scores.teamfight, 20);
        let total = scores.engage + scores.poke + scores.cc + scores.teamfight;
        return { total, scores, breakdown };
      }
      for (let top of candidates[0]) {
        for (let jungle of candidates[1]) {
          if (jungle.name === top.name) continue;
          for (let mid of candidates[2]) {
            if ([top.name, jungle.name].includes(mid.name)) continue;
            for (let adc of candidates[3]) {
              if ([top.name, jungle.name, mid.name].includes(adc.name)) continue;
              for (let support of candidates[4]) {
                if ([top.name, jungle.name, mid.name, adc.name].includes(support.name)) continue;
                const comp = [top, jungle, mid, adc, support];
                const { total, scores, breakdown } = getCompScore(comp);
                allComps.push({ comp, scores, breakdown, total });
              }
            }
          }
        }
      }
      // Sort all comps by score descending
      allComps.sort((a, b) => b.total - a.total);
      let currentIdx = 0;
      // Render function
      function renderComp(idx) {
        let main = document.querySelector('main');
        let old = document.getElementById('highest-comp-section');
        if (old) old.remove();
        let section = document.createElement('section');
        section.id = 'highest-comp-section';
        section.style.marginTop = '2em';
        let bestComp = allComps[idx];
        section.innerHTML = `<h2 style='color:#43b581;'>Highest Scoring Comp</h2>` +
          bestComp.comp.map((champ, i) => `<span class='champion'>${champ.name}</span> <span style='color:#43b581;'>(${lanes[i]})</span>`).join(' | ') +
          `<hr><b>Synergy Scores:</b><br>Engage: ${bestComp.scores.engage}/20, Poke: ${bestComp.scores.poke}/20, CC: ${bestComp.scores.cc}/20, Teamfight: ${bestComp.scores.teamfight}/20<br><span style='font-size:1.5em; color:#f7b731; font-weight:bold; display:block; margin:0.5em 0;'>Overall Score: ${bestComp.total}/80</span><hr>${bestComp.breakdown}` +
          `<button id='next-comp-btn' style='margin-top:1em; padding:0.7em 1.5em; font-size:1.1em; background:#43b581; color:#181a20; border-radius:8px; border:2px solid #c89b3c; cursor:pointer;'>Show Next Highest Comp</button>`;
        main.appendChild(section);
        document.getElementById('next-comp-btn').onclick = function() {
          currentIdx = (currentIdx + 1) % allComps.length;
          renderComp(currentIdx);
        };
      }
      // Initial render
      renderComp(currentIdx);
    }
    document.addEventListener('championDataLoaded', findHighestScoringComp);
  </script>
</body>
</html>
